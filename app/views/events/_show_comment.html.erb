<div class="comments" data-id="<%= @comment.id %>">
  <% if current_user %>
    <% vote = @comment.vote_by(current_user) %>
  <% end %>

  <% if vote %>

    <% if vote.value > 0 %>
      <% vote.value = -1 %>
      
      <%= form_for vote, url: vote_path(vote), method: :delete do |f| %>
        <%= f.submit 'Up!', class: "upvoted button"%>
      <% end %>

      <div><%= @comment.votes_sum %></div>

      <%= form_for vote do |f|%>
        <%= f.hidden_field :comment_id %>
        <%= f.hidden_field :value %>
        <%= f.submit "Down!", class: "downvote button" %>
      <% end %>

    <% elsif vote.value < 0 %>
      
      <% vote.value = 1 %>
      <%= form_for vote do |f|%>
        <%= f.hidden_field :comment_id %>
        <%= f.hidden_field :value %>
        <%= f.submit "Up!", class: 'upvote button' %>
      <% end %>

      <div><%= @comment.votes_sum %></div>
      
      <%= form_for vote, url: vote_path(vote), method: :delete do |f| %>
      <%= f.submit 'Down!', class: 'downvoted button' %>
      <% end %>
    <% end %>

  <% elsif current_user %>

    <%= form_for Vote.new(comment: @comment, value: 1) do |f|%>
      <%= f.hidden_field :comment_id %>
      <%= f.hidden_field :value %>
      <%= f.submit "Up!", class: 'upvote button'%>
    <% end %>

    <div><%= @comment.votes_sum %></div>

    <%= form_for Vote.new(comment: @comment, value: -1) do |f|%>
      <%= f.hidden_field :comment_id %>
      <%= f.hidden_field :value %>
      <%= f.submit "Down!", class: 'downvote button' %>
    <% end %>

  <% end %>

  <div><%= @comment.text %></div>
  <div>Posted by: <%= @comment.author.twitter_handle %></div><br>

  <a class="reply" href="#">reply</a>
  <div class="reply" id="reply<%= @comment.id %>">
    <%= render "comment_form" %>
  </div>

  <hr>

  <div class="nested">
    <% @comment.replies.each do |comment| %>
      <% @comment = comment %>
      <%= render "show_comment" %>
    <% end %>
  </div>
</div>